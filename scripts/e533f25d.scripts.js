"use strict";angular.module("scorecardApp",["ngRoute","ui.chart"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/admin",{templateUrl:"views/admin.html",controller:"AdminCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("scorecardApp").controller("AdminCtrl",["$scope","storage",function(a,b){a.alerts=[],a.annees=[2013,2014],a.trimestres=["T1","T2","T3","T4"],a.mois={T1:["Janvier","Février","Mars"],T2:["Avril","Mai","Juin"],T3:["Juillet","Août","Septembre"],T4:["Octobre","Novembre","Décembre"]},a.statuts=["En avance ou dans les temps par rapport au plan","En retard de moins de 3 mois par rapport au plan","En retard de plus de 3 mois par rapport au plan"],a.booleens=["Non","Oui"],a.trimestre="T1",a.annee=2013,a.$watch("[trimestre, annee]",function(){a.data=b.get(a.trimestre,a.annee)},!0),a.save=function(){b.set(a.trimestre,a.annee,a.data),a.alerts.push({type:"success",message:"Données enregistrées"})},a.reset=function(){b.remove(a.trimestre,a.annee),a.data=b.get(a.trimestre,a.annee)}}]),angular.module("scorecardApp").controller("MainCtrl",["$scope","storage",function(a,b){a.statuts=["En avance ou dans les temps par rapport au plan","En retard de moins de 3 mois par rapport au plan","En retard de plus de 3 mois par rapport au plan"],a.booleens=["Non","Oui"],a.trimestres=b.keys,a.trimestre=a.trimestres[a.trimestres.length-1],a.allData={},a.$watch("trimestre",function(b){a.data=a.allData[b]}),a.chartOptions={title:"Evolution du nombre estim&eacute; d'utilisatrices de m&eacute;thodes contraceptives modernes",axes:{xaxis:{renderer:jQuery.jqplot.CategoryAxisRenderer}},legend:{show:!0,location:"se"},series:[{label:"Nombre d'utilisatrices"},{label:"Objectif"}]},a.somme=function(a){return 0!==a.length?a.reduce(function(a,b){return parseInt(a,10)+parseInt(b,10)}):void 0},a.trimestres.forEach(function(c,d){var e,f,g,h=b.get(c),i=a.trimestres[d-1],j=a.trimestres[d-2],k=a.trimestres[d-4];if(i&&(e=a.allData[i]),j&&(f=a.allData[j]),k&&(g=a.allData[k]),a.allData[c]=h,h.contraceptifsTotal=0,h.contraceptifs.forEach(function(b,c){var d=a.somme(b.consommation);if(h.contraceptifs[c].total=d,h.contraceptifsTotal+=d,i){var f=e.contraceptifs[c].total,j=(d-f)/f;j=Math.round(1e4*j)/100,h.contraceptifs[c].trimestreChange=j}if(k){var l=g.contraceptifs[c].total,m=(d-l)/l;m=Math.round(1e4*m)/100,h.contraceptifs[c].yearChange=m}}),i){var l=h.contraceptifsTotal-e.contraceptifsTotal;l/=e.contraceptifsTotal,h.contraceptifsTrimestreChange=Math.round(1e4*l)/100}if(k){var m=h.contraceptifsTotal-g.contraceptifsTotal;m/=g.contraceptifsTotal,h.contraceptifsYearChange=Math.round(1e4*m)/100}j&&h.engagements.forEach(function(a,b){h.engagements[b].activites.forEach(function(a,c){if("pourcentage"===h.engagements[b].activites[c].forme){var d=h.engagements[b].activites[c].valeur,e=f.engagements[b].activites[c].valeur;h.engagements[b].activites[c].prev=d-e}})})}),a.chartData=[[],[]],a.trimestres.forEach(function(b){var c=a.allData[b];a.chartData[0].push([b,c.contraceptifsTotal]),a.chartData[1].push([b,5e5])})}]),angular.module("scorecardApp").service("storage",["$window",function(a){var b=JSON.parse(a.localStorage.getItem("scorecard_data"))||{},c={contraceptifs:[{nom:"Pilules",consommation:[]},{nom:"Injectables",consommation:[]},{nom:"Implants",consommation:[]},{nom:"DIU",consommation:[]},{nom:"Préservatifs",consommation:[]},{nom:"Contraception d'urgence",consommation:[]},{nom:"Stérilisation",consommation:[]}],programmes:[{type:"Demande",description:"activités prioritaires liées à la demande",activites:[{},{},{}]},{type:"Accès aux services",description:"activités prioritaires liées à l'accès aux services",activites:[{},{},{}]},{type:"Disponibilité des produits",description:"activités prioritaires liées à la disponibilité des produits",activites:[{},{},{}]}],engagements:[{type:"Financements",activites:[{nom:"Part du budget du PF promise",forme:"pourcentage"},{nom:"Part du budget du PF reçue",forme:"pourcentage"},{nom:"Part du budget du PF financée par le gouvernement",forme:"pourcentage"}]},{type:"Engagement politique",activites:[{nom:"Adoption des normes de l'OMS",forme:"booleen"},{nom:"Remontée de la fonction PF dans les organigrammes",forme:"booleen"}]},{type:"Suivi et coordination",activites:[{nom:"Un comité technique de mise en œuvre du plan a eu lieu ce trimestre",forme:"booleen"},{nom:"Part des régions dont les données sont intégrées dans ce rapport",forme:"pourcentage"}]}]};return{get:function(a,d){var e=d?a+" "+d:a;return b[e]||angular.copy(c)},set:function(c,d,e){var f;e?f=c+" "+d:(f=c,e=d),b[f]=angular.copy(e),a.localStorage.setItem("scorecard_data",JSON.stringify(b))},remove:function(c,d){var e=d?c+" "+d:c;delete b[e],a.localStorage.setItem("scorecard_data",JSON.stringify(b))},keys:Object.keys(b).sort(function(a,b){var c=a.split(" "),d=b.split(" ");return c[1]===d[1]?c[0]-d[0]:c[1]-d[1]})}}]);